<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - HappyVille_Booking_System</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <link rel="icon" href="~/images/LOGO.jpg" type="image/jpeg" />
    <link rel="stylesheet" href="~/HappyVille_Booking_System.styles.css" asp-append-version="true" />
</head>
<body>
    <header id="mainNav">
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light">
           @*  <div class="container-fluid"> *@
                <div class="logo">
                   <img src="~/images/logo.jpg" />
                </div>
@*                 <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">HappyVille_Booking_System</a>
 *@                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">


                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav flex-grow-1">
                        @* <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
                        </li> *@

                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="adminPage">Privacy</a>
                    </li>

                        <li>
                            <a href="#activities">Activities</a>
                        </li>
                        <li>
                            <a href="#pricing">Pricing</a>
                        </li>
                        <li>
                            <a href="#booking">Book Now</a>
                        </li>
                        <li>
                            <a href="#contact">Contact</a>
                        </li>

                        <li>
                        <a href="javascript:void(0)" onclick="openLoginModal()" class="login-link">
                           Admin Login
                        </a>
                        </li>
                    </ul>
                </div>
@*             </div>
 *@        </nav>

        <!-- Admin Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeLoginModal()">&times;</span>

                <h2>Admin Login</h2>
                <p class="modal-subtitle">Restricted access for authorized personnel only</p>

                <div class="modal-body">
                    <form id="loginForm">
                        <label for="loginEmail">Admin Email:</label>
                        <input type="email" id="loginEmail" required
                               placeholder="admin@yourdomain.com">

                        <label for="loginPassword">Password:</label>
                        <div class="password-wrapper">
                            <input type="password" id="loginPassword" required
                                   placeholder="Enter admin password">
                            <button type="button" class="show-password"
                                    onclick="togglePasswordVisibility()">
                                üëÅÔ∏è
                            </button>
                        </div>

                        <div class="form-options">
                            <label class="checkbox remember-me">
                                <input type="checkbox" id="rememberMe">
                                Keep me logged in
                            </label>

                            <a href="javascript:void(0)" onclick="showForgotPassword()"
                               class="forgot-password">
                                Forgot password?
                            </a>
                        </div>

                        <button type="submit" class="submit-btn login-btn">
                            Login as Admin
                        </button>
                    </form>

                    <!-- Forgot Password Section -->
                    <div id="forgotPasswordSection" style="display: none;">
                        <h3>Admin Password Reset</h3>
                        <p>Enter your admin email to receive a password reset link.</p>
                        <p class="warning-text">‚ö†Ô∏è This will notify all administrators</p>

                        <form id="forgotPasswordForm">
                            <label for="resetEmail">Admin Email:</label>
                            <input type="email" id="resetEmail" required
                                   placeholder="admin@yourdomain.com">

                            <div class="form-actions">
                                <button type="button" class="secondary-btn"
                                        onclick="hideForgotPassword()">
                                    Back to Login
                                </button>
                                <button type="submit" class="submit-btn">
                                    Request Reset
                                </button>
                            </div>
                        </form>

                        <p id="resetMessage" class="form-message"></p>
                    </div>

                    <p id="loginMessage" class="form-message"></p>

                    <div class="admin-note">
                        <p><strong>Note:</strong> This area is for administrative purposes only.</p>
                        <p>If you're a customer, please use the booking system above.</p>
                    </div>
                </div>
            </div>
        </div>

    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            <p>&copy; 2023 HappyVille. Safe, energetic, and fun for all!</p>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>

<script>
        document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;
        const rememberMe = document.getElementById('rememberMe').checked;

        const loginMessage = document.getElementById('loginMessage');

        // Check lockout status
        const now = Date.now();
        if (lockoutUntil > now) {
            const remainingTime = Math.ceil((lockoutUntil - now) / 1000 / 60);
            loginMessage.textContent = `Too many failed attempts. Try again in ${remainingTime} minutes.`;
            loginMessage.className = 'form-message error';
            return;
        }

        // Basic validation
        if (!email || !password) {
            loginMessage.textContent = 'Please enter both email and password';
            loginMessage.className = 'form-message error';
            return;
        }

        // Show loading state
        const submitBtn = document.querySelector('.login-btn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Authenticating...';
        submitBtn.disabled = true;

        // Simulate API call to your backend
        setTimeout(() => {
            // REPLACE THIS WITH ACTUAL ADMIN AUTHENTICATION
            // This is just a mock example

            // List of valid admin emails (configure these in your actual backend)
            const validAdminEmails = [
                'admin@example.com',
                'supervisor@example.com',
                'manager@example.com'
            ];

            // Check if email is in admin list and password matches
            // In real implementation, this would be a server-side check
            const isValidAdmin = validAdminEmails.includes(email);
            const isCorrectPassword = password === 'admin123'; // Change this!
            if (isValidAdmin && isCorrectPassword) {
                // Successful login
                loginMessage.textContent = '‚úì Login successful! Redirecting to admin panel...';
                loginMessage.className = 'form-message success';

                // Store session
                sessionStorage.setItem('adminLoggedIn', 'true');
                sessionStorage.setItem('adminEmail', email);

                if (rememberMe) {
                    localStorage.setItem('adminRememberedEmail', email);
                }

                // Reset login attempts on success
                loginAttempts = 0;

                // Redirect to admin dashboard or update UI
                setTimeout(() => {
                    closeLoginModal();
                    window.location.href = '@Url.Action("AdminPage", "Home")';
                }, 1500);

            } else {
                // Failed login
                loginAttempts++;

                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    lockoutUntil = now + LOCKOUT_TIME;
                    loginMessage.textContent = `Too many failed attempts. Account locked for 5 minutes.`;
                } else {
                    loginMessage.textContent = `Invalid credentials. ${MAX_LOGIN_ATTEMPTS - loginAttempts} attempts remaining.`;
                }

                loginMessage.className = 'form-message error';
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }, 1000);
    });

</script>

</html>
